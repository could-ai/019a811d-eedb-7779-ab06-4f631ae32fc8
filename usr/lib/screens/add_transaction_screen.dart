import 'package:flutter/material.dart';\nimport 'package:flutter/services.dart';\nimport '../models/transaction.dart';\n\nclass AddTransactionScreen extends StatefulWidget {\n  const AddTransactionScreen({super.key});\n\n  @override\n  State<AddTransactionScreen> createState() => _AddTransactionScreenState();\n}\n\nclass _AddTransactionScreenState extends State<AddTransactionScreen> {\n  final _formKey = GlobalKey<FormState>();\n  final _titleController = TextEditingController();\n  final _amountController = TextEditingController();\n  final _notesController = TextEditingController();\n\n  TransactionType _selectedType = TransactionType.expense;\n  String _selectedCategory = 'Food';\n  DateTime _selectedDate = DateTime.now();\n\n  final List<String> _expenseCategories = [\n    'Food',\n    'Transportation',\n    'Shopping',\n    'Entertainment',\n    'Bills',\n    'Healthcare',\n    'Education',\n    'Other',\n  ];\n\n  final List<String> _incomeCategories = [\n    'Salary',\n    'Freelance',\n    'Investment',\n    'Gift',\n    'Other',\n  ];\n\n  List<String> get _categories {\n    return _selectedType == TransactionType.expense\n        ? _expenseCategories\n        : _incomeCategories;\n  }\n\n  @override\n  void dispose() {\n    _titleController.dispose();\n    _amountController.dispose();\n    _notesController.dispose();\n    super.dispose();\n  }\n\n  Future<void> _selectDate(BuildContext context) async {\n    final DateTime? picked = await showDatePicker(\n      context: context,\n      initialDate: _selectedDate,\n      firstDate: DateTime(2020),\n      lastDate: DateTime.now(),\n    );\n    if (picked != null && picked != _selectedDate) {\n      setState(() {\n        _selectedDate = picked;\n      });\n    }\n  }\n\n  void _saveTransaction() {\n    if (_formKey.currentState!.validate()) {\n      final transaction = Transaction(\n        id: DateTime.now().millisecondsSinceEpoch.toString(),\n        title: _titleController.text,\n        amount: double.parse(_amountController.text),\n        date: _selectedDate,\n        type: _selectedType,\n        category: _selectedCategory,\n        notes: _notesController.text.isEmpty ? null : _notesController.text,\n      );\n\n      Navigator.pop(context, transaction);\n    }\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(\n        title: const Text('Add Transaction'),\n        elevation: 0,\n      ),\n      body: SingleChildScrollView(\n        padding: const EdgeInsets.all(16),\n        child: Form(\n          key: _formKey,\n          child: Column(\n            crossAxisAlignment: CrossAxisAlignment.start,\n            children: [\n              // Transaction Type Selector\n              const Text(\n                'Transaction Type',\n                style: TextStyle(fontSize: 16, fontWeight: FontWeight.bold),\n              ),\n              const SizedBox(height: 8),\n              SegmentedButton<TransactionType>(\n                segments: const [\n                  ButtonSegment(\n                    value: TransactionType.expense,\n                    label: Text('Expense'),\n                    icon: Icon(Icons.arrow_downward),\n                  ),\n                  ButtonSegment(\n                    value: TransactionType.income,\n                    label: Text('Income'),\n                    icon: Icon(Icons.arrow_upward),\n                  ),\n                ],\n                selected: {_selectedType},\n                onSelectionChanged: (Set<TransactionType> newSelection) {\n                  setState(() {\n                    _selectedType = newSelection.first;\n                    _selectedCategory = _categories.first;\n                  });\n                },\n              ),\n              const SizedBox(height: 24),\n\n              // Title Field\n              TextFormField(\n                controller: _titleController,\n                decoration: const InputDecoration(\n                  labelText: 'Title',\n                  hintText: 'Enter transaction title',\n                  border: OutlineInputBorder(),\n                  prefixIcon: Icon(Icons.title),\n                ),\n                validator: (value) {\n                  if (value == null || value.isEmpty) {\n                    return 'Please enter a title';\n                  }\n                  return null;\n                },\n              ),\n              const SizedBox(height: 16),\n\n              // Amount Field\n              TextFormField(\n                controller: _amountController,\n                decoration: const InputDecoration(\n                  labelText: 'Amount',\n                  hintText: 'Enter amount',\n                  border: OutlineInputBorder(),\n                  prefixIcon: Icon(Icons.attach_money),\n                ),\n                keyboardType: TextInputType.number,\n                inputFormatters: [\n                  FilteringTextInputFormatter.allow(RegExp(r'^\d+\.?\d{0,2}')),\n                ],\n                validator: (value) {\n                  if (value == null || value.isEmpty) {\n                    return 'Please enter an amount';\n                  }\n                  if (double.tryParse(value) == null) {\n                    return 'Please enter a valid number';\n                  }\n                  if (double.parse(value) <= 0) {\n                    return 'Amount must be greater than 0';\n                  }\n                  return null;\n                },\n              ),\n              const SizedBox(height: 16),\n\n              // Category Dropdown\n              DropdownButtonFormField<String>(\n                value: _selectedCategory,\n                decoration: const InputDecoration(\n                  labelText: 'Category',\n                  border: OutlineInputBorder(),\n                  prefixIcon: Icon(Icons.category),\n                ),\n                items: _categories.map((category) {\n                  return DropdownMenuItem(\n                    value: category,\n                    child: Text(category),\n                  );\n                }).toList(),\n                onChanged: (value) {\n                  setState(() {\n                    _selectedCategory = value!;\n                  });\n                },\n              ),\n              const SizedBox(height: 16),\n\n              // Date Picker\n              ListTile(\n                contentPadding: const EdgeInsets.symmetric(horizontal: 12),\n                shape: RoundedRectangleBorder(\n                  borderRadius: BorderRadius.circular(4),\n                  side: BorderSide(color: Colors.grey.shade400),\n                ),\n                leading: const Icon(Icons.calendar_today),\n                title: const Text('Date'),\n                subtitle: Text(\n                  '${_selectedDate.day}/${_selectedDate.month}/${_selectedDate.year}',\n                ),\n                onTap: () => _selectDate(context),\n              ),\n              const SizedBox(height: 16),\n\n              // Notes Field\n              TextFormField(\n                controller: _notesController,\n                decoration: const InputDecoration(\n                  labelText: 'Notes (Optional)',\n                  hintText: 'Add notes',\n                  border: OutlineInputBorder(),\n                  prefixIcon: Icon(Icons.note),\n                ),\n                maxLines: 3,\n              ),\n              const SizedBox(height: 24),\n\n              // Save Button\n              SizedBox(\n                width: double.infinity,\n                child: ElevatedButton(\n                  onPressed: _saveTransaction,\n                  style: ElevatedButton.styleFrom(\n                    padding: const EdgeInsets.symmetric(vertical: 16),\n                    shape: RoundedRectangleBorder(\n                      borderRadius: BorderRadius.circular(8),\n                    ),\n                  ),\n                  child: const Text(\n                    'Save Transaction',\n                    style: TextStyle(fontSize: 16),\n                  ),\n                ),\n              ),\n            ],\n          ),\n        ),\n      ),\n    );\n  }\n}